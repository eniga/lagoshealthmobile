<ion-header>
    <ion-toolbar>
        <ion-buttons slot="start">
          <ion-button [routerLink]="['/members/dashboard']">
            <ion-icon slot="icon-only" name="arrow-back" style="color:#fff"></ion-icon>
          </ion-button>
        </ion-buttons>
        <ion-title>Update Patient Details</ion-title>
      </ion-toolbar>
</ion-header>

<ion-content padding>
    <button id="close-scanner-button" ion-button color="btn btn-default" (click)="CancelScan()">Cancel</button>
  <form *ngIf = "!isEdit">
    <div class="container">
        <div class="form-group">
            <label>Enter Phone Number </label> <input type="text" name="phone"  maxlength="11" minlength="11"
            pattern="[0-9]*" class="form-control" [(ngModel)]="phone" (keypress)="numberOnly($event)"/>
          </div>
        <div class="modal-footer">
            <div class="right-side">
              <button class="btn btn-success" type="button" (click)="Search()">
                Search
              </button>
            </div>        
          </div>
    </div>
    <div class="container" *ngIf="!patients">
      <p style="text-align: center"><b>No patients found.</b></p>
    </div>
      <div class="card" *ngIf="patients.length > 0">
          <p><b>Search Result</b></p>
        <div class="container" *ngFor="let p of patients">        
            <p><b>Patient's Name: </b> {{p.lastName}}, {{p.firstName}}</p>
            <p><b>Phone Number: </b>{{p.phone}} <button class="btn btn-default" (click)="GetPatientDetails(p)" style="float:right">Update Details</button></p>
            <br/><hr/>
        </div>
        </div>  
  </form>

  <!--- Form to update details -->
  <form *ngIf = "isEdit">
    <div class="form-group">
      <label>First Name </label> <input class="form-control" name="firstName" [(ngModel)]="patient.firstName"/>
    </div>
    <div class="form-group">
      <label>Middle Name </label> <input class="form-control" name="middleName" [(ngModel)]="patient.middleName"/>
    </div>
    <div class="form-group">
      <label>Last Name </label> <input class="form-control" name="lastName" [(ngModel)]="patient.lastName"/>
    </div>
    <label>Phone </label><input type="text" name="name"  maxlength="11" minlength="11"
     pattern="[0-9]*" class="form-control" [(ngModel)]="patient.phone" (keypress)="numberOnly($event)"/>
    <!-- <div class="form-group">
      <label>Phone </label> <input class="form-control" name="phone" [(ngModel)]="patient.phone" 
      oninput="javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);"
    type = "number" maxlength = "11"/>
    </div> -->
    <div class="form-group">
      <label>Alt Phone (Optional) </label> <input class="form-control" name="altPhone" [(ngModel)]="patient.altPhone" 
      oninput="javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);"
      type = "number" maxlength = "11"/>
    </div>
    <div class="form-group">
      <label>Email (Optional) </label> <input type="email" class="form-control" name="email" [(ngModel)]="patient.email"/>
    </div>
    <div class="form-group">
      <label>Date Of Birth </label> <input type="date" class="form-control" name="dob" [(ngModel)]="patient.dob"/>
    </div>
    <div class="form-group">
      <label>LGA </label>
      <select class="form-control" name="selectedLga" [(ngModel)]="selectedLga" (change)="FilterWard(selectedLga)">
        <option *ngFor= "let item of lgas" value="{{item.lgaId}}">{{item.lga}}</option>
      </select>
    </div>
    <div class="form-group" *ngIf="selectedLga">
        <label>Ward </label>
        <select class="form-control" name="selectedWard" [(ngModel)]="selectedWard" (change)="FilterSettlement(selectedWard)">
          <option disabled="disabled">Select Ward</option>
            <option *ngFor= "let item of wards" value="{{item.wardId}}">{{item.ward}}</option>
          </select>
      </div>
      <div class="form-group" *ngIf="selectedWard">
          <label>Settlement </label>
          <select class="form-control" name="settlementId" [(ngModel)]="patient.settlementId">
              <option disabled="disabled">Select Settlement</option>
              <option *ngFor= "let item of settlements" value="{{item.settlementId}}">{{item.settlement}}</option>
            </select>
        </div>
        <div class="form-group" *ngIf="selectedWard">
            <label>House Number </label>
            <input type="text" class="form-control" name="houseNumber" [(ngModel)]="patient.houseNumber"/>
          </div>
        <div class="form-group">
            <button (click)="scanQR()"><ion-icon name="camera">
              </ion-icon> Scan QR Code</button>
            <label *ngIf="patient.qrCode" style="text-align: left;margin-left: 25%;font-weight: bolder;color:blue;">
              {{patient.qrCode}}
            </label>
          </div>
    <div class="modal-footer">
      <div class="left-side">
        <button class="btn btn-default" [routerLink]="['/members/dashboard']" type="button">Cancel</button>
      </div>
      <div class="divider"></div>
      <div class="right-side">
        <button class="btn btn-success" type="button" (click)="AddPatient()">
          Update
        </button>
      </div>
    </div>
  </form>
</ion-content>
